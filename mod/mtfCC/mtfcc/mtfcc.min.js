var T={},mtfCC={isContained:function(a,b){var c,d,e;if(!(a instanceof Array&&b instanceof Array))return!1;if(a.length<b.length)return!1;for(c=a.toString(),d=0,e=b.length;e>d;d++)if(-1==c.indexOf(b[d]))return!1;return!0},utf8to16:function(a){for(var b,c,d,e="",f=a.length,g=0;f>g;)switch(b=a.charCodeAt(g++),b>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=a.charAt(g-1);break;case 12:case 13:c=a.charCodeAt(g++),e+=String.fromCharCode((31&b)<<6|63&c);break;case 14:c=a.charCodeAt(g++),d=a.charCodeAt(g++),e+=String.fromCharCode((15&b)<<12|(63&c)<<6|(63&d)<<0)}return e},I:function(a){return $("#"+a)[0]},aC:function(a,b){var c=$("<"+a+">")[0];return $("#"+b).append(c),c},c:"",cj:[],t:[],a:[],j:[],h:[],T:"",S:"",to:[],no:{},ic:{},e:function(s){try{return eval(s.split("^")[1])}catch(error){return!1}},g:function(a,b){var d,c=mtfCC.j[b].length;for(d=0;c>d;d++)if(mtfCC.j[b][d]==a)return d;return 0},f:function(a){return a.replace(/&amp;/gi,"&").replace(/<div.*<\/div>/gi,"").replace(/<(?!(\/p|b|\/b|img|\/img)\b)[^>]*>/gi,"").replace(/&lt;/gi,"<").replace(/&gt;/gi,">")},l:function(a){var b,c,d,e,f,g,h;if("undefined"==typeof mtfCC.a[a]){for(mtfCC.a[a]=[],mtfCC.j[a]=[],mtfCC.h[a]=[],mtfCC.t[a]=0,mtfCC.to[a]=[],mtfCC.c=mtfCC.f($("#"+a).html().replace(/<P(.*?)>/gi,"")),mtfCC.c=mtfCC.c.split(/<\/P>/i),window[a+"JS"]&&(mtfCC.cj=JSON.parse(mtfCC.utf8to16(window.atob(window[a+"JS"]))),window[a+"JS"]=""),b=mtfCC.c.length,c=0,d=0,e=0;b>e;e++)f=$.trim(mtfCC.c[e]+(mtfCC.cj[e]?mtfCC.f(mtfCC.utf8to16(window.atob(mtfCC.cj[e]))):"")),f&&(g=$.trim(f).split(" "),h=g[0],isNaN(h)?(mtfCC.a[a][c]+="/n/n"+f,d!=c&&(mtfCC.t[a]++,d=c)):(mtfCC.j[a].push(h),mtfCC.a[a][h]=f,c=h));mtfCC.c=[],mtfCC.cj=[],mtfCC.d(a,0)}},tr:function(a,b){var f,h,i,c=a.split(" "),d=c.length,e=c[0],g=c[d-1];return d>2&&(g.indexOf("^")>-1||!isNaN(g)||"|"===g)?c.splice(d-1,1):g="",c.splice(0,1),f=c.join(" "),h=isNaN(e)?mtfCC.no[b]+e:mtfCC.no[b]=e,i=f?mtfCC.v(f):"",{i:h,n:e,s:i,j:g,ar1:a.substr(e.length+2).split(" ")}},v:function(s){var l,i,ar=s.match(/\^T\._\S+?\^/g);if($.isArray(ar)&&ar[0])for(l=ar.length,i=0;l>i;i++)s=s.replace(ar[i],eval(ar[i].substr(1,ar[i].length-2)));return s},d:function(a,b,c){var d,e,f,g,h,i,j,k;if(mtfCC.ic[a]=!1,d=c?c:mtfCC.j[a][b],!mtfCC.a[a][d])return!1;if(e=mtfCC.a[a][d].split(/\/n\/n/i),f=e.length,g=mtfCC.tr(e[0],a),c&&(b=mtfCC.g(c,a)),1===f){if("^"===g.s.substr(0,1)){for(e=g.ar1,f=e.length,h=0;f>h;h+=2){if(i=e[h].split("^"),i[1]&&mtfCC.e(e[h])&&""==i[0])return mtfCC.o(a,parseInt(b)+1,e[h+1]?e[h+1]:"","",1),void 0;if(i[0]&&mtfCC.isContained(mtfCC.h[a],i[0].split(",")))return mtfCC.o(a,parseInt(b)+1,e[h+1]?e[h+1]:"","",1),void 0}return mtfCC.to[a][0]?(mtfCC.d(a,"",mtfCC.to[a][0]),mtfCC.to[a].shift(),void 0):(Ply.dialog("alert",mtfLang.get(["无","结果"])),$("#"+a).delay(100).fadeIn(),void 0)}if(mtfCC.I(a).innerHTML=g.s,g.j&&mtfCC.e(g.j),mtfCC.aC("ul",a).id=j=a+"_"+d+"_"+(parseInt(b)+1)+"_"+(g.j&&"|"!==g.j?g.j.split("^")[0]:""),mtfCC.I(j).className="mtfCC-sel",g.j&&"|"==g.j)mtfCC.r(g.n,a,function(a){mtfCC.I(j).innerHTML+="<br>（<b>"+(a[g.n]?a[g.n]:0+mtfLang.get("人"))+"</b>"+mtfLang.get(["与你相同"])+")"}),mtfCC.I(j).innerHTML=mtfLang.get("再来一遍"),mtfCC.I(a).innerHTML=mtfCC.I(a).innerHTML.replace(g.s,"<b>"+g.s+"</b>"),mtfCC.I(j).onclick=function(){return mtfCC.ic[a]?!1:(mtfCC.ic[a]=!0,mtfCC.h[a]=[],mtfCC.to[a]=[],mtfCC.o(a,0,"",this),void 0)};else{if(mtfCC.ic[a])return!1;mtfCC.ic[a]=!0,mtfCC.I(j).innerHTML=mtfLang.get("继续"),mtfCC.I(j).onclick=function(){mtfCC.o(a,this.id.split("_")[2],this.id.split("_")[3],this)}}}else for(mtfCC.I(a).innerHTML=g.s,g.j&&mtfCC.e(g.j),h=1;f>h;h++)g=mtfCC.tr(e[h],a),j=a+"___"+d+g.n+"___"+(parseInt(b)+1)+"___"+(g.j&&"|"!==g.j?g.j.split("^")[0].replace(/,/g,"_"):""),mtfCC.aC("ul",a).id=j,mtfCC.I(j).className="mtfCC-sel",mtfCC.I(j).innerHTML=g.s,mtfCC.I(j).setAttribute("j",g.j?g.j.split("^")[1]:""),mtfCC.I(j).onclick=function(){var b=this.id.split("___"),c=this.getAttribute("j");mtfCC.h[a].push(b[1]),b[3]||c?mtfCC.o(a,b[2],b[3]+(c?"^"+c:""),this):mtfCC.r(b[1],b[0],function(b){var f,g,h,i,c=[],d=[],e=mtfCC.a[a];for(f in e){g=e[f].split(/\/n\/n/i);for(h in g)i=mtfCC.tr(g[h],a),d[i.i]=i.s}for(f in b)c.push(d[f]+"："+mtfLang.get(b[f].split(" ")));Ply.dialog("alert",{title:mtfLang.get("结果"),html:c.join("<br>")})})};k=mtfCC.aC("div",a),k.innerHTML="<div>"+mtfLang.get("最多")+"<b>"+mtfCC.t[a]+"</b>"+mtfLang.get(["次","选择"])+"，"+(g.j&&"|"===g.j?"<b>"+mtfCC.h[a].length+"</b>"+mtfLang.get(["次","完成"])+"<br>":mtfLang.get(["已经","完成"])+"<b>"+mtfCC.h[a].length+"</b>"+mtfLang.get("次"))+"</div>",mtfCC.T&&(M.alert(mtfCC.T),mtfCC.T=""),k.innerHTML='<button class="m-button" onclick="mtfCC.save(\''+a+"','"+b+"')\">"+mtfLang.get("存档")+'</button><button class="m-button" onclick="mtfCC.load(\''+a+"')\">"+mtfLang.get("读档")+"</button>"+(mtfCC.S?mtfCC.S:"")+k.innerHTML,mtfCC.S="",$("#"+a).delay(100).fadeIn()},r:function(a,b,c){mtfCC.ajax("result",{i:a,id:MTF.ID(),si:b.replace("mtfCC","")},c)},o:function(a,b,c,d,e){if(d&&(d.className="mtfCC-sel-a"),f=[],c){var f=c.split("^");f[1]&&mtfCC.e(c),f=f[0].split("_"),c=f[0]}!c&&mtfCC.to[a][0]&&(c=mtfCC.to[a][0],mtfCC.to[a].shift()),e?(dl=0,mtfCC.d(a,b,c)):(f.length>1&&(f.shift(),mtfCC.to[a]=f,f[f.length-1]||(mtfCC.to[a].shift(),mtfCC.to[a].push(mtfCC.j[a][b]))),dl=150,$("#"+a).delay(dl).fadeOut("",function(){mtfCC.d(a,b,c)}))},ajax:function(a,b,c){$.ajax({url:MTF.Var.domain.api+"bt/mtfCC/",data:$.extend(b,{type:a}),success:function(a){c&&c(a)}})},SL:function(a,b,c){store.get("uid")?mtfCC.ajax("list","",function(d){var f,g,h,i,j,e={};for(d=JSON.parse(d),f=1,g=6;g>=f;f++)h="s"+f,i="s"===b?h:d&&d[h]?JSON.stringify(d[h]):"",j=d&&d[h]?d[h].i+" "+d[h].time:"",e["m"+h]={tag:"input",type:"button",className:"ply-input mtfCCi",hint:i,value:j};Ply.dialog("alert",{title:mtfLang.get(("s"===b?"存":"读")+"档"),form:e}),$(".mtfCCi").click(function(){$(".ply-overlay").parent().remove(),"s"===b?mtfCC.save(a,c,$(this).attr("placeholder")):mtfCC.load(a,$(this).attr("placeholder"))})}):Ply.dialog("alert",mtfLang.get(["请","登录"]))},save:function(a,b,c){var d={};if(c){for(o in T)0==o.indexOf("_")&&(d[o]=T[o]);d.h=mtfCC.h[a].join(","),d.j=mtfCC.j[a][b],d.i=MTF.ID(),d.id=a.replace("mtfCC",""),d.si=c,mtfCC.ajax("save",d)}else mtfCC.SL(a,"s",b)},load:function(a,b){if(b){var c=JSON.parse(b);if(c.i!==MTF.ID())return Ply.dialog("confirm","",mtfLang.get("离开")+"?").done(function(){MTF.Render.jump(c.i)}),!1;a="mtfCC"+c.id,mtfCC.h[a]=c.h?c.h.split(","):[];for(o in T)0==o.indexOf("_")&&(T[o]=isNaN(c[o])?c[o]:parseFloat(c[o]));mtfCC.d(a,"",c.j)}else mtfCC.SL(a,"l")}};