!function(a){"use strict";"function"==typeof define&&define.amd?define(a):window["Ply"]=a()}(function(){"use strict";function m(a){if(l)return new l(a);var b=j.Deferred();return a(b.resolve,b.reject),b}function n(a){return l?l.all(a):j.when.apply(j,a)}function o(a){return m(function(b){return b(a)})}function p(a){return a&&a.then?a:o(a)}function q(a){return"function"==typeof a}function r(a,b){if(a)for(var c in a)a.hasOwnProperty(c)&&b(a[c],c,a)}function s(a){var b={};return r(a,function(a,c){b[c]=q(a)?a:a instanceof Object?s(a):a}),b}function t(a){for(var b=Array.prototype.slice,c=b.call(arguments,1),d=0,e=c.length;e>d;d++)r(c[d],function(b,c){a[c]=b});return a}function v(a,b){try{return(b||d).querySelector(a)}catch(c){return j(a,b)[0]}}function w(a,b){return a.getElementsByTagName(b)}function x(a,b){try{a&&b&&a.appendChild(b)}catch(c){}}function y(a){a&&a.parentNode&&a.parentNode.removeChild(a)}function z(a,b,c){var e=c.handle=c.handle||function(b){b.target||(b.target=b.srcElement||d),3===b.target.nodeType&&(b.target=b.target.parentNode),b.preventDefault||(b.preventDefault=function(){b.returnValue=!1}),b.stopPropagation||(b.stopPropagation=function(){b.cancelBubble=!0}),c.call(a,b)};a.addEventListener?a.addEventListener(b,e,!1):a.attachEvent("on"+b,e)}function A(a,b,c){var d=c.handle;d&&(a.removeEventListener?a.removeEventListener(b,d,!1):a.detachEvent("on"+b,d))}function B(a){if(null==a&&(a="div"),a.appendChild)return a;if(a.skip)return d.createDocumentFragment();"string"==typeof a&&(a={tag:a});var b,c=a.children,e=u.exec(a.tag||"");return delete a.children,a.tag=e[1]||"div",a.id=a.id||(e[2]||"").substr(1),e=(e[3]||"").split("."),e[0]=a.className||"",a.className=e.join(" "),b=d.createElement(a.tag),delete a.tag,r(a,function(c,e){if(c)if("css"===e)F(b,a.css);else if("text"===e)null!=c&&x(b,d.createTextNode(c));else if("html"===e)null!=c&&(b.innerHTML=c);else if("ply"===e)b.setAttribute(i,c);else if(e in b)try{b[e]=c}catch(f){b.setAttribute(e,c)}else/^data-/.test(e)&&b.setAttribute(e,c)}),c&&c.appendChild?x(b,c):r(c,function(a,c){a&&("string"==typeof a?a={text:a}:"object"!=typeof a&&(a={}),"string"==typeof c&&(a.tag=a.tag||c),x(b,B(a)))}),b}function C(a){for(var e,f,b=w(a,"input"),c=0,d=b.length;d>c;c++)if(e=b[c],"submit"===e.type)!f&&(f=e);else if(!/hidden|check|radio/.test(e.type)&&""==e.value){f=e;break}f||(f=w(a,"button")[0]);try{f.focus()}catch(g){}}function D(a){return G(!0),m(function(b){for(var f,c=w(a,"img"),d=c.length,e=d,g=function(){if(--e<=0){for(d=c.length;d--;)f=c[d],A(f,"load",g),A(f,"error",g);G(!1),b()}};d--;)f=c[d],f.complete?e--:(z(f,"load",g),z(f,"error",g));!e&&g()})}function F(a,b,c){if(a&&a.style&&b)if(b instanceof Object)for(var e in b)F(a,e,b[e]);else{if(void 0===c)return d.defaultView&&d.defaultView.getComputedStyle?c=d.defaultView.getComputedStyle(a,""):a.currentStyle&&(c=a.currentStyle),void 0===b?c:c[b];E[b]?E[b](a.style,c):a.style[g[b]||b]=c}}function G(a){var b=G.get();clearTimeout(G.pid),G.pid=a?e(function(){x(d.body,b)},100):e(function(){y(b)},100)}function H(a,b){return B({css:t({padding:"20px 20px 40px",display:"inline-block",position:"relative",textAlign:"left",whiteSpace:"normal",verticalAlign:"middle",transform:"translate3d(0, 0, 0)"},b.wrapper),children:b.baseHtml?[{ply:":layer",tag:".ply-layer",className:b.mod,css:t({overflow:"hidden",position:"relative",backfaceVisibility:"hidden"},b.layer),children:[b.flags.closeBtn&&{ply:":close",tag:".ply-x",text:f.cross},{tag:".ply-inside",children:a}]}]:a})}function I(a){return B({ply:":overlay",tag:".ply-overlay",css:{top:0,left:0,right:0,bottom:0,position:"fixed"},children:[{tag:"div",css:t({width:"100%",height:"100%"},a)}]})}function J(a,b,c){var e,f;return a.wrapEl=B({tag:b.rootTag,css:{whiteSpace:"nowrap",zIndex:b.zIndex},method:"post",action:"/"}),c||(a.overlayEl=I(b.overlay),a.overlayBoxEl=a.overlayEl.firstChild,x(a.wrapEl,a.overlayEl)),e=B(),F(e,{height:"100%",display:"inline-block",verticalAlign:"middle"}),x(a.wrapEl,e),f=b.el,a.el=f&&f.cloneNode?b.clone?f.cloneNode(!0):f:B({html:f||""}),a.layerEl=H(a.el,b),a.contentEl=K(a.layerEl),a.context=new P(a.layerEl),x(a.wrapEl,a.layerEl),a.bodyEl=b.body&&v(b.body)||d.body,a.wrapEl.tabIndex=-1,F(a.wrapEl,{top:0,left:0,right:0,bottom:0,position:"fixed",textAlign:"center",overflow:"auto",outline:0}),a}function K(a){return a.firstChild.lastChild.firstChild}function L(b,c){c=b instanceof Object?b:c||{},c.el=c.el||b;var d=this;d.cid="c"+a++,k.zIndex++,d.options=c=t({},k,c),c.flags=t({},k.flags,c.flags),J(d,c),d.setEffect(c.effect),d.fx=function(a){return!(d.fx.queue=d.fx.queue.then(a,a).then(function(){return d}))},d.fx.queue=o(),d.on("click",":overlay",function(){d.hasFlag("closeByOverlay")&&d.closeBy("overlay")}),d.on("click",":close",function(a,b){a.preventDefault(),d.closeBy("BUTTON"===b.nodeName?"cancel":"x")}),d.options.oninit(this)}function P(a){this.el=a}function Q(a){return a&&a.appendChild}function R(a,b){return null==a?{skip:!0}:("string"==typeof a&&(a={text:a}),"object"==typeof a&&(a.name=a.name||b),a)}function S(a,b,c){var e,d=S[a];return d||(a=a.split(/\s+/).slice(0,-1).join(" "),d=b&&(S[a+" [name="+b.name+"]"]||S[a+" [type="+b.type+"]"])||S[a+" *"]||S[":default"]),e=B(d(b,c)),b&&b.name&&e.setAttribute(i+"-name",b.name),e.className+=" ply-ui",e}function T(a,b){T["_"+a]=b,T[a]=function(a,c){return m(function(d,e){b(a,c,d,e)}).then(function(a){return Q(a)||(a=S(":root",a)),a})}}function U(a,b,c,d){return b.mod=a,b.effect=b.effect||"slide",b.flags=t({closeBtn:!1},b.flags),{header:c.title,content:c.form?{"dialog-form":{children:c.form}}:{el:c.text||c},ctrls:{ok:c.ok||d.ok,cancel:c.cancel===!1?null:c.cancel||d.cancel}}}var M,N,O,a=1,b=function(){},c=window,d=c.document,e=c.setTimeout,f={ok:"OK",cancel:"Cancel",cross:"âœ–"},g=function(){var a={},b=d.createElement("div").style,c="opacity transition transform perspective transformStyle transformOrigin backfaceVisibility".split(" "),e=["Webkit","Moz","O","MS"];return r(c,function(c,d){if(a[c]=c in b&&c,!a[c])for(d=0;4>d;d++){var f=e[d]+c.charAt(0).toUpperCase()+c.substr(1);if(a[c]=f in b&&f)break}}),a}(),h={esc:27},i="data-ply",j=window.jQuery||window.Zepto||window.ender||window.$,k={clone:!0,zIndex:1e4,rootTag:"form",baseHtml:!0,layer:{},wrapper:{},overlay:{opacity:.6,backgroundColor:"rgb(0, 0, 0)"},flags:{closeBtn:!0,bodyScroll:!1,closeByEsc:!0,closeByOverlay:!0,hideLayerInStack:!0,visibleOverlayInStack:!1},oninit:b,onopen:b,onclose:b,ondestroy:b,onaction:b},l=null,u=/^(\w+)?(#\w+)?((?:\.[\w_-]+)*)/i,E={opacity:!g.opacity&&function(a,b){a.zoom=1,a.filter="alpha(opacity="+100*b+")"}};return G.get=function(){return G.el||(G.el=B({tag:".ply-global-loading",children:{".ply-loading-spinner":!0}}))},L.fn=L.prototype={constructor:L,_activate:function(){if(!this.hasFlag("bodyScroll")){var a=this.bodyEl,b=B({css:{overflow:"auto",visibility:"hidden",height:"5px"},children:[{tag:"div",css:{height:"100px"}}]});this.__overflow=F(a,"overflow"),this.__paddingRight=F(a,"paddingRight"),x(a,b),F(a,{overflow:"hidden",paddingRight:b.offsetWidth-b.firstChild.offsetWidth+"px"}),y(b)}z(this.wrapEl,"submit",this._getHandleEvent("submit"))},_deactivate:function(){this.hasFlag("bodyScroll")||F(this.bodyEl,{overflow:this.__overflow,paddingRight:this.__paddingRight}),A(this.layerEl,"submit",this._getHandleEvent("submit"))},_getHandleEvent:function(a){var b=this,c=b.__handleEvent||(b.__handleEvent={});return c[a]||(c[a]=function(c){b._handleEvent(a,c)}),c[a]},_handleEvent:function(a,b){b.preventDefault(),this.closeBy(a)},$:function(a){return j(a,this.layerEl)},find:function(a){return v(a,this.layerEl)},applyEffect:function(a,b,c){return a=this[a]||a,a.nodeType||(c=b,b=a,a=this.layerEl),c=L.effects.get(c||this.effects),L.effects.apply.call(c,a,b)},closeBy:function(a){var b=this,c={by:a,state:"submit"===a,data:this.context.toJSON(),widget:this,context:this.context},e=(this.el,this.options.onaction(c));this.__lock||(this.__lock=!0,this.el.className+=" ply-loading",p(e).done(function(a){a!==!1&&(b.result=c,b.close())}).always(function(){b.__lock=!1,b.el.className=b.el.className.replace(/\s?ply-loading/,"")}))},on:function(a,b,c){var d=this;return c||(c=b,b=":layer"),c["_"+b]=function(a){var e=a.target;do if(1===e.nodeType&&e.getAttribute(i)===b)return c.call(d,a,e);while(e!==d.wrapEl&&(e=e.parentNode))},z(d.wrapEl,a,c["_"+b]),d},off:function(a,c,d){return d||(d=c,c="layer"),A(this.wrapEl,a,d["_"+c]||b),this},hasFlag:function(a){return!!this.options.flags[a]},setEffect:function(a){return this.effects=L.effects.get(a),this},_toggleState:function(a,b){var c=this,d=a?"open":"close",e=L.stack.last;return c.visible!=a&&(c.visible=a,c[a?"_activate":"_deactivate"](),L.stack[a?"add":"remove"](c),c.fx(function(){return D(c.wrapEl).then(function(){var f=L.stack.length===(a?1:0),g=e&&e.hasFlag("hideLayerInStack"),h=f||c.hasFlag("visibleOverlayInStack");return a?(!h&&y(c.overlayBoxEl),x(c.bodyEl,c.wrapEl),c.wrapEl.focus(),C(c.layerEl),g&&e.applyEffect("close.layer",b).then(function(){y(e.layerEl)})):(e=L.stack.last)&&(x(e.wrapEl,e.layerEl),e.hasFlag("hideLayerInStack")&&e.applyEffect("open.layer",b).then(function(){C(e.el)})),n([c.applyEffect(d+".layer",b),h&&c.applyEffect("overlayEl",d+".overlay",b)]).then(function(){a||(y(c.wrapEl),x(c.overlayEl,c.overlayBoxEl)),c.options["on"+d](c)})})})),c.fx.queue},open:function(a){return this.result=null,this._toggleState(!0,a)},close:function(a){return this._toggleState(!1,a)},_swap:function(a,b,c,d,e){var f=this;return f.visible?f.fx(function(){return D(b).then(function(){return d(),n([f.applyEffect(a,"close.layer",c),f.applyEffect(b,"open.layer",c)]).then(function(){y(a),e(),f.wrapEl.focus(),C(b)})})}):e(),f.fx.queue},swap:function(a,b){a=t({},this.options,a);var c=this,d=J({},a,!0),e=b||a.effect?L.effects.get(b||a.effect):c.effects,f=c.layerEl,g=d.layerEl;return c._swap(f,g,e,function(){x(c.bodyEl,c.wrapEl),x(c.bodyEl,d.wrapEl)},function(){y(d.wrapEl),x(c.wrapEl,g),c.el=d.el,c.layerEl=g,c.contentEl=K(g),c.context.el=g})},innerSwap:function(a,c){a=t({},this.options,a);var d=this,e=J({},a,!0),f=c||a.effect?L.effects.get(c||a.effect):d.effects,g=v(".ply-inside",e.layerEl),h=v(".ply-inside",d.layerEl);return d._swap(h,g,f,function(){F(h,{width:h.offsetWidth+"px",position:"absolute"}),x(h.parentNode,g)},b)},destroy:function(){y(this.wrapEl),this._deactivate(),L.stack.remove(this),this.visible=!1,this.options.ondestroy(this)}},M=[],N=M.push,O=M.splice,L.stack={_idx:{},last:null,length:0,_pop:function(a){var b=L.stack.last;a.keyCode===h.esc&&b.hasFlag("closeByEsc")&&b.closeBy("esc")},add:function(a){var b=N.call(this,a);this.last=a,this._idx[a.cid]=b-1,1===b&&z(d,"keyup",this._pop)},remove:function(a){var b=this._idx[a.cid];b>=0&&(O.call(this,b,1),delete this._idx[a.cid],this.last=this[this.length-1],this.last||A(d,"keyup",this._pop))}},L.effects={defaults:{duration:300,open:{layer:null,overlay:null},close:{layer:null,overlay:null}},setup:function(a){this.defaults=this.get(a)},set:function(a){t(this,a)},get:function(a){function c(a){var b=/^([\w_-]+)(?::(\d+%?))?(\[[^\]]+\])?/.exec(a)||[];return{name:b[1]||a,duration:b[2]||null,args:JSON.parse(b[3]||"null")||{}}}function d(b,d,e){var f=c(d),g=b[f.name]||e||{},h=f.duration||g.duration||b.duration||a.duration;return"string"==typeof g&&(g=c(g),delete g.args),/%/.test(g.duration)&&(g.duration=parseInt(g.duration,10)/100*h),g.duration=0|(g.duration||h),g}var e,f,g,h,i,j,k,b=s(this.defaults);"string"==typeof a?(e=c(a),a=s(this[e.name]||{open:{},close:{}}),a.duration=e.duration||a.duration,a.open.args=e.args[0],a.close.args=e.args[1]):a instanceof Array?(f=c(a[0]),g=c(a[1]),h=this[f.name],i=this[g.name],a={open:s(h&&h.open||{layer:a[0],overlay:a[0]}),close:s(i&&i.close||{layer:a[1],overlay:a[1]})},a.open.args=f.args[0],a.close.args=g.args[0]):a instanceof Object||(a={}),a.duration=0|(a.duration||b.duration);for(j in{open:0,close:0})k=a[j]||b[j]||{},"string"==typeof k&&(k={layer:k}),k.layer=d(k,"layer",b[j].layer),k.overlay=d(k,"overlay",b[j].overlay),void 0===k.args&&delete k.args,a[j]=k;return a},apply:function(a,b){b=b.split(".");var h,i,c=this[b[0]],d=a.firstChild,f=[a.getAttribute("style"),d&&d.getAttribute("style")];return g.transition&&c&&(i=c[b[1]])&&(h=L.effects[i.name])&&(h["to"]||h["from"])?(h=s(h),F(a,"transition","none"),F(d,"transition","none"),r(h["to"],function(b,c,d){"&"===b&&(d[c]=F(a,c))}),q(h["from"])?h["from"](a,c.args):h["from"]&&F(a,h["from"]),m(function(b){h.width=a.offsetWidth,F(a,"transition","all "+i.duration+"ms"),F(d,"transition","all "+i.duration+"ms"),q(h["to"])?h["to"](a,c.args):F(a,h["to"]),e(b,i.duration)}).then(function(){a.setAttribute("style",f[0]),d&&d.setAttribute("style",f[1])})):o()}},L.effects.set({fade:{open:{layer:"fade-in:80%",overlay:"fade-in:100%"},close:{layer:"fade-out:60%",overlay:"fade-out:60%"}},scale:{open:{layer:"scale-in",overlay:"fade-in"},close:{layer:"scale-out",overlay:"fade-out"}},fall:{open:{layer:"fall-in",overlay:"fade-in"},close:{layer:"fall-out",overlay:"fade-out"}},slide:{open:{layer:"slide-in",overlay:"fade-in"},close:{layer:"slide-out",overlay:"fade-out"}},"3d-flip":{open:{layer:"3d-flip-in",overlay:"fade-in"},close:{layer:"3d-flip-out",overlay:"fade-out"}},"3d-sign":{open:{layer:"3d-sign-in",overlay:"fade-in"},close:{layer:"3d-sign-out",overlay:"fade-out"}},inner:{open:{layer:"inner-in"},close:{layer:"inner-out"}},"fade-in":{from:{opacity:0},to:{opacity:"&"}},"fade-out":{to:{opacity:0}},"slide-in":{from:{opacity:0,transform:"translateY(20%)"},to:{opacity:"&",transform:"translateY(0)"}},"slide-out":{to:{opacity:0,transform:"translateY(20%)"}},"fall-in":{from:{opacity:0,transform:"scale(1.3)"},to:{opacity:"&",transform:"scale(1)"}},"fall-out":{to:{opacity:0,transform:"scale(1.3)"}},"scale-in":{from:{opacity:0,transform:"scale(0.7)"},to:{opacity:"&",transform:"scale(1)"}},"scale-out":{to:{opacity:0,transform:"scale(0.7)"}},rotate3d:function(a,b,c,d,e){F(a,{perspective:"1300px"}),F(a.firstChild,{opacity:b,transform:"rotate"+c+"("+d+"deg)",transformStyle:"preserve-3d",transformOrigin:e?"50% 0":"50%"})},"3d-sign-in":{from:function(a){L.effects.rotate3d(a,0,"X",-60,"50% 0")},to:function(a){F(a.firstChild,{opacity:1,transform:"rotateX(0)"})}},"3d-sign-out":{from:function(a){L.effects.rotate3d(a,1,"X",0,"50% 0")},to:function(a){F(a.firstChild,{opacity:0,transform:"rotateX(-60deg)"})}},"3d-flip-in":{from:function(a,b){L.effects.rotate3d(a,0,"Y",b||-70)},to:function(a){F(a.firstChild,{opacity:1,transform:"rotateY(0)"})}},"3d-flip-out":{from:function(a){L.effects.rotate3d(a,1,"Y",0)},to:function(a,b){F(a.firstChild,{opacity:0,transform:"rotateY("+(b||70)+"deg)"})}},"inner-in":{from:function(a){F(a,"transform","translateX(100%)")},to:function(a){F(a,"transform","translateX(0%)")}},"inner-out":{from:function(a){F(a,"transform","translateX(0%)")},to:function(a){F(a,"transform","translateX(-100%)")}}}),P.fn=P.prototype={constructor:P,getEl:function(a){return this.el?v("["+i+'-name="'+a+'"]',this.el):void 0},val:function(a,b){var c="string"==typeof a?this.getEl(a):a;return c&&null==c.value&&(c=w(c,"input")[0]||w(c,"textarea")[0]||w(c,"select")[0]),c&&null!=b&&(c.value=b),c&&c.value||""},toJSON:function(){for(var c,a=this.el.querySelectorAll("["+i+"-name]"),b={},d=a.length;d--;)c=a[d],b[c.getAttribute(i+"-name")]=this.val(c);return b}},S.factory=function(a,b,c){S[a.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ")]=function(e,f){var h,g=d.createDocumentFragment();return null!=e||":root"===a?(e=c?e:R(e),r(c?e:e.children,function(b,c){var d=((f||a)+" "+c).replace(/^:\w+\s+/,""),e=Q(b)?b:S(d,R(b,c),d);x(g,e)}),c||delete e.children,h=b(e,g),Q(h)||t(h,e),h):g}},S.factory(":default",function(a,b){return a.children=b,a}),S.factory(":root",function(a){return{tag:".ply-form",className:a.mod,children:[S(":header",a.header),S(":content",a.content),a.ctrls&&S(":default",{tag:"div.ply-footer",children:a.ctrls})]}}),S.factory(":header",function(a,b){return{tag:".ply-header",text:a.text,children:b}}),S.factory(":content",function(a,b){return{tag:".ply-content",children:b}},!0),S.factory("ok",function(a){return{ply:":ok",tag:"button.ply-ctrl.ply-ok",text:a===!0?f.ok:a}}),S.factory("cancel",function(a){return{ply:":close",tag:"button.ply-ctrl.ply-cancel",type:"reset",text:a===!0?f.cancel:a}}),T.use=function(a,b,c,d,e){T["_"+a](b,c,d,e)},T("default",function(a,b,c){c(b||{})}),T("base",function(a,b,c){c(U("base",a,b))}),T("alert",function(a,b,c){c(U("alert",a,b,{ok:!0}))}),T("confirm",function(a,b,c){c(U("confirm",a,b,{ok:!0,cancel:!0}))}),T("prompt",function(a,b,c){c(U("prompt",a,b,{ok:!0,cancel:!0}))}),S.factory("dialog-form *",function(a){return{tag:"input.ply-input",type:a.type||"text",name:a.name,value:a.value,required:!0,placeholder:a.hint||a.text}}),L.create=function(a,b,c){if(Q(a))return o(new L(t(b||{},{el:a})));c||(c=b,b={});var d=T[a]||T["default"];return d(b,c).then(function(a){return new L(t(b,{el:a}))})},L.open=function(a,b,c){return L.create(a,b,c).then(function(a){return a.open()})},L.dialog=function(a,c,d){return a instanceof Object&&!Q(a)?(c=c||{},m(function(d,e){var g,h,i,f=c.initState,j=a,k={},l=function(a,d){(c.progress||b)(t({name:g.$name,index:g.$index,length:n,stack:j,current:g,widget:d},a),k)},m=function(a,c,d){var e=JSON.parse(JSON.stringify(a.data));g=a,i=!0,(a.prepare||b)(e,k),L.create(a.ui||"alert",a.options||{},e).then(function(b){var e;h?e=h[/^inner/.test(c)?"innerSwap":"swap"](b,c):(h=b,e=h.open()),e.then(function(){k[a.$name].el=h.layerEl,i=!1}),d(h)})},n=0;r(j,function(a,b){f=f||b,a.effects=a.effects||{},a.$name=b,a.$index=n++,k[b]=new L.Context}),j.$length=n,m(j[f],null,function(a){l({},a),h.options.onaction=function(a){if(i)return!1;var b=a.state||"next"===g.back,c=j[g[b?"next":"back"]];return c?(m(c,g[b?"nextEffect":"backEffect"],function(b){l(a,b)}),!1):((a.state?d:e)(a,k),void 0)}})})):(d||Q(a)||(d=c||{},c={}),L.open(a,c,d).then(function(a){return m(function(b,c){a.options.onclose=function(){(a.result.state?b:c)(a.result)}})}))},L.ui=S,L.factory=T,L.lang=f,L.css=F,L.cssHooks=E,L.keys=h,L.noop=b,L.each=r,L.extend=t,L.promise=m,L.Promise=l,L.support=g,L.defaults=k,L.attrName=i,L.Context=P,L.dom={build:B,append:x,remove:y,addEvent:z,removeEvent:A},L.version="0.6.1",L});