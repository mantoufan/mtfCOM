!function(){function b(){return"ontouchstart"in window||"onmsgesturechange"in window}function c(a,b,c){return c>a+b&&(a=c-b),a>0?0:a}function d(a){var g,b=a.split(","),c=atob(b[1]),d=b[0].split(":")[1].split(";")[0],e=new ArrayBuffer(c.length),f=new Uint8Array(e);for(g=0;g<c.length;g++)f[g]=c.charCodeAt(g);return new Blob([e],{type:d})}function f(f){function g(a,b,c){this.width=null,this.height=null,this.img_width=null,this.img_height=null,this.img_left=0,this.img_top=0,this.minPercent=null,this.options=b,this.$image=a,this.$image.hide().prop("draggable",!1).addClass("cropImage").wrap('<div class="cropFrame" />'),this.$frame=this.$image.parent(),this.on_load=c||function(){},this.init()}g.prototype={init:function(){var c,d,a=this,b=f("<div/>",{"class":"cropControls"}).append(f("<span>"+this.options.label+"</span>")).append(f("<button/>",{"class":"cropZoomIn",type:"button"}).on("click",f.proxy(this.zoomIn,this))).append(f("<button/>",{"class":"cropZoomOut",type:"button"}).on("click",f.proxy(this.zoomOut,this)));this.$frame.append(this.options.controls||b),this.updateOptions(),"function"==typeof f.fn.hammer||"undefined"!=typeof Hammer?(c="function"==typeof f.fn.hammer?this.$image.hammer().data("hammer"):Hammer(this.$image.get(0)),c.get("pan").set({direction:Hammer.DIRECTION_ALL,threshold:0}),c.get("pinch").set({enable:!0}),c.on("panleft panright panup pandown",function(b){d||(d={startX:a.img_left,startY:a.img_top}),d.dx=b.deltaX,d.dy=b.deltaY,b.preventDefault(),a.drag.call(a,d,!0)}).on("panend pancancel",function(b){b.preventDefault(),d=null,a.update.call(a)}).on("doubletap",function(b){b.preventDefault(),a.zoomIn.call(a)}).on("pinchin",function(b){b.preventDefault(),a.zoomOut.call(a)}).on("pinchout",function(b){b.preventDefault(),a.zoomIn.call(a)})):(this.$image.on("dragstart",function(){return!1}),this.$image.on("mousedown."+e,function(b){var c={startX:a.img_left,startY:a.img_top};b.preventDefault(),f(document).on("mousemove."+e,function(d){c.dx=d.pageX-b.pageX,c.dy=d.pageY-b.pageY,a.drag.call(a,c,!0)}).on("mouseup."+e,function(){a.update.call(a),f(document).off("mouseup."+e),f(document).off("mousemove."+e)})})),f.fn.mousewheel&&this.$image.on("mousewheel."+e,function(b){b.preventDefault(),b.deltaY<0?a.zoomIn.call(a):a.zoomOut.call(a)})},updateOptions:function(){var c,a=this;a.img_top=0,a.img_left=0,a.$image.css({width:"",left:a.img_left,top:a.img_top}),a.$frame.width(a.options.width).height(a.options.height),a.$frame.off("."+e),a.$frame.removeClass("hover"),"always"===a.options.showControls||"auto"===a.options.showControls&&b()?a.$frame.addClass("hover"):"never"!==a.options.showControls&&(a.$frame.on("mouseenter."+e,function(){a.$frame.addClass("hover")}),a.$frame.on("mouseleave."+e,function(){a.$frame.removeClass("hover")})),c=new Image,c.onload=function(){a.width=c.width,a.height=c.height,c.src="",c.onload=null,a.percent=void 0,a.fit.call(a),a.options.result?a.setCrop.call(a,a.options.result):a.zoom.call(a,a.minPercent),a.$image.fadeIn("fast"),a.on_load.call(a)},c.src=a.$image.attr("src")},remove:function(){var a;"function"==typeof f.fn.hammer?a=this.$image.data("hammer"):"undefined"!=typeof Hammer&&(a=Hammer(this.$image.get(0))),a&&a.off("panleft panright panup pandown panend pancancel doubletap pinchin pinchout"),this.$frame.off("."+e),this.$image.off("."+e),this.$image.css({width:"",left:"",top:""}),this.$image.removeClass("cropImage"),this.$image.removeData(e),this.$image.insertAfter(this.$frame),this.$frame.removeClass("cropFrame"),this.$frame.removeAttr("style"),this.$frame.empty(),this.$frame.remove()},fit:function(){var a=this.options.width/this.width,b=this.options.height/this.height;this.minPercent=a>=b?a:b},setCrop:function(a){this.percent=Math.max(this.options.width/a.cropW,this.options.height/a.cropH),this.img_width=Math.ceil(this.width*this.percent),this.img_height=Math.ceil(this.height*this.percent),this.img_left=-Math.floor(a.cropX*this.percent),this.img_top=-Math.floor(a.cropY*this.percent),this.$image.css({width:this.img_width,left:this.img_left,top:this.img_top}),this.update()},zoom:function(a){var d,b=this.percent;this.percent=Math.max(this.minPercent,Math.min(this.options.maxZoom,a)),this.img_width=Math.ceil(this.width*this.percent),this.img_height=Math.ceil(this.height*this.percent),b?(d=this.percent/b,this.img_left=c((1-d)*this.options.width/2+d*this.img_left,this.img_width,this.options.width),this.img_top=c((1-d)*this.options.height/2+d*this.img_top,this.img_height,this.options.height)):(this.img_left=c((this.options.width-this.img_width)/2,this.img_width,this.options.width),this.img_top=c((this.options.height-this.img_height)/2,this.img_height,this.options.height)),this.$image.css({width:this.img_width,left:this.img_left,top:this.img_top}),this.update()},zoomIn:function(){this.zoom(this.percent+(1-this.minPercent)/(this.options.zoom-1||1))},zoomOut:function(){this.zoom(this.percent-(1-this.minPercent)/(this.options.zoom-1||1))},drag:function(a,b){this.img_left=c(a.startX+a.dx,this.img_width,this.options.width),this.img_top=c(a.startY+a.dy,this.img_height,this.options.height),this.$image.css({left:this.img_left,top:this.img_top}),b||this.update()},update:function(){this.result={cropX:-Math.ceil(this.img_left/this.percent),cropY:-Math.ceil(this.img_top/this.percent),cropW:Math.floor(this.options.width/this.percent),cropH:Math.floor(this.options.height/this.percent),stretch:this.minPercent>1},this.$image.trigger(e,[this.result,this])},getDataURL:function(){if(!a)return!1;var b=document.createElement("canvas"),c=b.getContext("2d");return b.width=this.options.width,b.height=this.options.height,c.drawImage(this.$image.get(0),this.result.cropX,this.result.cropY,this.result.cropW,this.result.cropH,0,0,this.options.width,this.options.height),b.toDataURL()},getBlob:function(){return d(this.getDataURL())}},f.fn[e]=function(a,b){return this.each(function(){var h,c=f(this),d=c.data(e);d?a&&(f.extend(d.options,a),d.updateOptions()):(h=f.extend({},f.fn[e].defaultOptions,a),c.data(e,new g(c,h,b)))})},f.fn[e].defaultOptions={width:200,height:200,zoom:10,maxZoom:1,controls:null,showControls:"auto",label:"Drag to crop"}}var e,a=document.createElement("canvas");a=!(!a.getContext||!a.getContext("2d")),e="cropbox","function"==typeof require&&"object"==typeof exports&&"object"==typeof module?f(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],f):f(window.jQuery||window.Zepto)}();