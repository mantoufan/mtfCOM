# yzhanPod
Y 站容器是对 Y 站应用及运行时的封装，将原来“推送”变为“拉取”，持续部署到集群
## 部署变化
### 过去 · 推送
开发机 → 部署脚本，标识 应用名 → 跳板机根据 应用名 → 分发代码至不同应用服务器及同一应用不同节点
### 现在 · 拉取
开发机 → 提交代码到各应用开发仓库 → 通知：更新应用仓库的引用到容器仓库，等待部署  
手动执行 / 定时任务 / 通知：标签筛选后的容器更新应用代码

## 架构
Y 站应用的业务部分包括 7 个独立模块：
- 对象资源处理应用（图片、音视频、压缩包、文档、种子等）
- 富文本资源处理应用（文章、评论、日志、网址等）
- 鉴权应用（合法请求识别、拦截、验证码）
- 消息应用（实时同步弹幕、评论、文章更新）
- 分享应用（分享链接生成、防红、分享奖励分发）
- 队列应用（异步任务调度）
- 前端应用

Y 站应用的平台部分包括：
- 业务部分的可复用代码
- 模块及模块间的依赖关系
  - 文件处理模块
    - 音视频图像文档压缩包种子的相似哈希 / 读取 / 转码，主体 / 声音 / 人脸 / 颜色识别，自动分类模块
    - 富文本的相似哈希 / 语种识别 / 关键词过滤模块
  - 其它前后端模块
- 部署脚本
  - 根据应用声明的模块
  - 将应用依赖模块和模块自身依赖的模块，打包，压缩，生成到应用
  - 将应用上传至跳板机，由跳板机完成在线安装、编译和分发

## 通信变化
不同应用间通过 API 通信，通过消息应用和队列应用中转，调度消息和异步任务
### 过去 · 公网
应用部署不同公网的服务器，相互间通信受公网影响，通知都收敛到消息和队列应用，存在单一节点故障
### 现在 · 容器内 / 集群内通信
应用组合部署到同一容器，容器内通信。共享持久化存储和数据  
只有需要负载均衡的通知，收敛到消息和队列应用，集群内通信